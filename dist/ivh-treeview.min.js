angular.module("ivh.treeview",[]),angular.module("ivh.treeview").directive("ivhTreeviewCheckboxHelper",[function(){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewCheckboxHelper"},require:"^ivhTreeview",link:function(a,b,c,d){var e=a.node,f=d.opts(),g=f.indeterminateAttribute,h=f.selectedAttribute;a.isSelected=e[h],a.trvw=d,a.$watch(function(){return e[h]},function(b){a.isSelected=b}),a.$watch(function(){return e[g]},function(a){b.find("input").prop("indeterminate",a)})},template:['<input type="checkbox"','ng-model="isSelected"','ng-change="trvw.select(node, isSelected)" />'].join("\n")}}]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{restrict:"AE",require:"^ivhTreeviewNode",template:'<span ivh-treeview-checkbox-helper="node"></span>'}}]),angular.module("ivh.treeview").directive("ivhTreeviewChildren",function(){"use strict";return{restrict:"AE",require:"^ivhTreeviewNode",template:['<ul ng-if="getChildren().length" class="ivh-treeview">','<li ng-repeat="child in getChildren()"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="childDepth">',"</li>","</ul>"].join("\n")}}),angular.module("ivh.treeview").directive("ivhTreeviewNode",["ivhTreeviewCompiler","ivhTreeviewOptions",function(a,b){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewNode",depth:"=ivhTreeviewDepth"},require:"^ivhTreeview",compile:function(b){return a.compile(b,function(a,b,c,d){var e=a.node,f=a.getChildren=function(){return d.children(e)};a.trvw=d,a.childDepth=a.depth+1,d.expand(e,d.isInitiallyExpanded(a.depth));a.$watch(function(){return f().length>0},function(a){a?b.removeClass("ivh-treeview-node-leaf"):b.addClass("ivh-treeview-node-leaf")})})},template:b().nodeTpl}}]),angular.module("ivh.treeview").directive("ivhTreeviewToggle",[function(){"use strict";return{restrict:"A",require:"^ivhTreeview",link:function(a,b,c,d){var e=a.node;b.addClass("ivh-treeview-toggle"),b.bind("click",function(){a.$apply(function(){d.onNodeClick(e),d.toggleExpanded(e)})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewTwistie",["$compile","ivhTreeviewOptions",function(a,b){"use strict";var c=b();return{restrict:"A",require:"^ivhTreeview",template:['<span class="ivh-treeview-twistie">','<span class="ivh-treeview-twistie-collapsed">',c.twistieCollapsedTpl,"</span>",'<span class="ivh-treeview-twistie-expanded">',c.twistieExpandedTpl,"</span>",'<span class="ivh-treeview-twistie-leaf">',c.twistieLeafTpl,"</span>","</span>"].join("\n"),link:function(b,d,e,f){if(f.hasLocalTwistieTpls){var g=f.opts(),h=d.children().eq(0).children();angular.forEach(["twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl"],function(d,e){var f=g[d],i=c[d];if(f&&f!==i){("<"!==f.substr(0,1)||">"!==f.substr(-1,1))&&(f="<span>"+f+"</span>");var j=a(f)(b),k=h.eq(e);k.html("").append(j)}})}}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["ivhTreeviewMgr",function(a){"use strict";return{restrict:"A",transclude:!0,scope:{root:"=ivhTreeview",childrenAttribute:"=ivhTreeviewChildrenAttribute",clickHandler:"=ivhTreeviewClickHandler",changeHandler:"=ivhTreeviewChangeHandler",defaultSelectedState:"=ivhTreeviewDefaultSelectedState",expandToDepth:"=ivhTreeviewExpandToDepth",idAttribute:"=ivhTreeviewIdAttribute",indeterminateAttribute:"=ivhTreeviewIndeterminateAttribute",expandedAttribute:"=ivhTreeviewExpandedAttribute",labelAttribute:"=ivhTreeviewLabelAttribute",nodeTpl:"=ivhTreeviewNodeTpl",selectedAttribute:"=ivhTreeviewSelectedAttribute",twistieCollapsedTpl:"=ivhTreeviewTwistieCollapsedTpl",twistieExpandedTpl:"=ivhTreeviewTwistieExpandedTpl",twistieLeafTpl:"=ivhTreeviewTwistieLeafTpl",useCheckboxes:"=ivhTreeviewUseCheckboxes",validate:"=ivhTreeviewValidate",visibleAttribute:"=ivhTreeviewVisibleAttribute",userOptions:"=ivhTreeviewOptions",filter:"=ivhTreeviewFilter"},controllerAs:"trvw",controller:["$scope","$element","$attrs","$transclude","ivhTreeviewOptions","filterFilter",function(b,c,d,e,f,g){var h=angular,i=this,j=h.extend({},f(),b.userOptions);h.forEach(["childrenAttribute","defaultSelectedState","expandToDepth","idAttribute","indeterminateAttribute","expandedAttribute","labelAttribute","nodeTpl","selectedAttribute","twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl","useCheckboxes","validate","visibleAttribute"],function(a){h.isDefined(b[a])&&(j[a]=b[a])});var k;e(function(a,b){var c="";angular.forEach(a,function(a){c+=(a.innerHTML||"").trim()}),c.length&&(k=b,j.nodeTpl=c)}),i.opts=function(){return j};var l=b.userOptions||{};i.hasLocalTwistieTpls=!!(l.twistieCollapsedTpl||l.twistieExpandedTpl||l.twistieLeafTpl||b.twistieCollapsedTpl||b.twistieExpandedTpl||b.twistieLeafTpl),i.children=function(a){var b=a[j.childrenAttribute];return h.isArray(b)?b:[]},i.label=function(a){return a[j.labelAttribute]},i.hasFilter=function(){return h.isDefined(b.filter)},i.getFilter=function(){return b.filter||""},i.getNodeTpl=function(){return j.nodeTpl},i.isVisible=function(a){var b=i.getFilter();return b?!!g([a],b).length:!0},i.useCheckboxes=function(){return j.useCheckboxes},i.select=function(c,d){a.select(b.root,c,j,d),i.onNodeChange(c,d)},i.isSelected=function(a){return a[j.selectedAttribute]},i.toggleSelected=function(a){var b=!a[j.selectedAttribute];i.select(a,b)},i.expand=function(c,d){a.expand(b.root,c,j,d)},i.isExpanded=function(a){return a[j.expandedAttribute]},i.toggleExpanded=function(a){i.expand(a,!i.isExpanded(a))},i.isInitiallyExpanded=function(a){var b=-1===j.expandToDepth?1/0:j.expandToDepth;return b>a},i.isLeaf=function(a){return 0===i.children(a).length},i.getNodeTpl=function(){return j.nodeTpl},i.onNodeClick=function(a){(b.clickHandler||angular.noop)(a,b.root)},i.onNodeChange=function(a,c){(b.changeHandler||angular.noop)(a,c,b.root)}}],link:function(b){var c=b.trvw.opts();c.validate&&a.validate(b.root,c)},template:['<ul class="ivh-treeview">','<li ng-repeat="child in root | ivhTreeviewAsArray"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="0">',"</li>","</ul>"].join("\n")}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(a){return!angular.isArray(a)&&angular.isObject(a)?[a]:a}}),angular.module("ivh.treeview").factory("ivhTreeviewBfs",["ivhTreeviewOptions",function(a){"use strict";var b=angular;return function(c,d,e){2===arguments.length&&b.isFunction(d)&&(e=d,d={}),d=angular.extend({},a(),d),e=e||b.noop;var f,g,h,i,j,k=[],l=d.childrenAttribute;for(b.isArray(c)?(b.forEach(c,function(a){k.push([a,[]])}),f=k.shift()):f=[c,[]];f;){if(g=f[0],h=f[1],e(g,h)!==!1&&g[l]&&b.isArray(g[l]))for(j=g[l].length,i=0;j>i;i++)k.push([g[l][i],[g].concat(h)]);f=k.shift()}}}]),angular.module("ivh.treeview").factory("ivhTreeviewCompiler",["$compile",function(a){"use strict";return{compile:function(b,c){angular.isFunction(c)&&(c={post:c}),b.contents().remove();var d;return{pre:c&&c.pre?c.pre:null,post:function(b,e,f,g){d||(d=a(g.getNodeTpl())),d(b,function(a){e.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("ivh.treeview").factory("ivhTreeviewMgr",["ivhTreeviewOptions","ivhTreeviewBfs",function(a,b){"use strict";var c=angular,d=a(),e={},f=function(a){a[this.selectedAttribute]=!1,a[this.indeterminateAttribute]=!1},g=function(a){a[this.selectedAttribute]=!0,a[this.indeterminateAttribute]=!1},h=function(a){var b=a[this.childrenAttribute],d=this.selectedAttribute,e=this.indeterminateAttribute,f=0,g=0;c.forEach(b,function(a){a[d]?f++:a[e]&&g++}),0===f&&0===g?(a[d]=!1,a[e]=!1):f===b.length?(a[d]=!0,a[e]=!1):(a[d]=!1,a[e]=!0)},i=function(a,d,e,f){var g=c.isString(d),h=!0,i=e.idAttribute,j=null,k=[];return b(a,e,function(a,b){var c=h&&(g?d===a[i]:d===a);return c&&(h=!1,j=a,k=b),h}),f(j,k)};return e.select=function(a,i,j,k){arguments.length>2&&"boolean"==typeof j&&(k=j,j={}),j=c.extend({},d,j),k=c.isDefined(k)?k:!0;var l=c.isString(i),m=!0,n=j.idAttribute;return b(a,j,function(a,d){var e=m&&(l?i===a[n]:i===a);if(e){m=!1;var o=k?g.bind(j):f.bind(j);b(a,j,o),c.forEach(d,h.bind(j))}return m}),e},e.selectAll=function(a,f,g){arguments.length>1&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:!0;var h=f.selectedAttribute,i=f.indeterminateAttribute;return b(a,f,function(a){a[h]=g,a[i]=!1}),e},e.selectEach=function(a,b,d,f){return c.forEach(b,function(b){e.select(a,b,d,f)}),e},e.deselect=function(a,b,c){return e.select(a,b,c,!1)},e.deselectAll=function(a,b){return e.selectAll(a,b,!1)},e.deselectEach=function(a,b,c){return e.selectEach(a,b,c,!1)},e.validate=function(a,f,g){arguments.length>1&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:f.defaultSelectedState;var h=f.selectedAttribute,i=f.indeterminateAttribute;return b(a,f,function(b){return c.isDefined(b[h])&&b[h]!==g?(e.select(a,b,f,!g),!1):(b[h]=g,void(b[i]=!1))}),e},e.expand=function(a,b,f,g){arguments.length>2&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:!0;var h=c.isString(b),j=f.expandedAttribute;return h?i(a,b,f,function(a){return a[j]=g,e}):(b[j]=g,e)},e.expandRecursive=function(a,f,g,h){arguments.length>2&&"boolean"==typeof g&&(h=g,g={}),f=c.isDefined(f)?f:a,g=c.extend({},d,g),h=c.isDefined(h)?h:!0;var j,k=c.isString(f),l=g.expandedAttribute;return k?i(a,f,g,function(a){j=a}):j=f,j&&b(j,g,function(a){a[l]=h}),e},e.collapse=function(a,b,c){return e.expand(a,b,c,!1)},e.collapseRecursive=function(a,b,c){return e.expandRecursive(a,b,c,!1)},e.expandTo=function(a,b,f,g){arguments.length>2&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:!0;var h=f.expandedAttribute,j=function(a){a[h]=g};return i(a,b,f,function(a,b){return c.forEach(b,j),e})},e.collapseParents=function(a,b,c){return e.expandTo(a,b,c,!1)},e}]),angular.module("ivh.treeview").provider("ivhTreeviewOptions",function(){"use strict";var a={idAttribute:"id",labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,validate:!1,indeterminateAttribute:"__ivhTreeviewIndeterminate",expandedAttribute:"__ivhTreeviewExpanded",defaultSelectedState:!0,twistieExpandedTpl:"(-)",twistieCollapsedTpl:"(+)",twistieLeafTpl:"o",nodeTpl:['<div title="{{trvw.label(node)}}">',"<span ivh-treeview-toggle>","<span ivh-treeview-twistie></span>","</span>",'<span ng-if="trvw.useCheckboxes()"',"ivh-treeview-checkbox>","</span>",'<span class="ivh-treeview-node-label" ivh-treeview-toggle>',"{{trvw.label(node)}}","</span>","<div ivh-treeview-children></div>","</div>"].join("\n")};this.set=function(b){angular.extend(a,b)},this.$get=function(){return function(){return angular.copy(a)}}});